      - name: Push USD/CNY Rate
        env:
          BARK_KEY: ${{ secrets.BARK_KEY }}
        run: |
          python - << 'EOF'
          import requests
          import json
          import os   # <--- 加这一行！！！

          bark_key = os.environ.get('BARK_KEY')  # 安全取值
          if not bark_key:
              title = "Secret 缺失"
              body = "BARK_KEY 未注入，请检查 GitHub Secrets"
          else:
              try:
                  api_url = "https://open.er-api.com/v6/latest/USD"
                  resp = requests.get(api_url, timeout=10)
                  data = resp.json()
                  
                  if data.get('result') == 'success':
                      cny = data['rates']['CNY']
                      rate = round(cny, 4)
                      title = "美元汇率更新"
                      body = f"1 USD = {rate} CNY (成功获取)"
                  else:
                      title = "API 失败"
                      body = f"API 返回: {data.get('result', '未知')}"
              except Exception as e:
                  title = "脚本异常"
                  body = f"错误: {str(e)[:80]}..."
          
          # 无论如何都推（debug）
          sound = "minuet"
          if bark_key:
              bark_url = f"https://api.day.app/{bark_key}/{body}?title={title}&sound={sound}&badge=1"
              try:
                  resp = requests.get(bark_url)
                  print("Bark 响应码:", resp.status_code)
              except Exception as push_err:
                  print("推送失败:", str(push_err))
          else:
              print("无 BARK_KEY，无法推送")
          EOF
